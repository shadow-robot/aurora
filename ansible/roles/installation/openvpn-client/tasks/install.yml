---
- name: Install OpenVPN dependencies
  apt:
    name: ["easy-rsa"]
    state: "present"

- name: Add OpenVPN repo apt key
  apt_key:
    url: "https://swupdate.openvpn.net/repos/repo-public.gpg"
    id: "30EBF4E73CCE63EEE124DD278E6DA8B4E158C569"
    state: "present"

- name: Add OpenVPN repository
  apt_repository:
    repo: "{{ openvpn_apt_repository }}"
    state: "present"
    update_cache: "yes"

- name: Install OpenVPN
  apt:
    name: openvpn
    state: "present"

- name: Fetch client configurations
  fetch:
    src: "{{ user_folder }}/openvpn-ca/{{ client_name }}/{{ item|basename }}"
    dest: "{{ shadow_hand_launcher_folder }}/"
    flat: yes
  with_items:
    - "{{ client_name }}.ovpn"
