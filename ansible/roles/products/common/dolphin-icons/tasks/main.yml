---
- name: Dolphin file manager installation for Icons handling
  apt:
    name: "dolphin"
    state: 'present'
    update_cache: yes    
  become: yes

- name: Create Dolphin Folder
  file:
    path: "{{ shadow_hand_launcher_folder }}/Shadow Icons"
    state: directory
  changed_when: false

- name: Check if Demos folder exist
  stat:
    path: "{{ shadow_demos_folder }}"
  register: demo_path

- name: Create Demos Folder
  file:
    path: "{{ shadow_hand_launcher_folder }}/Shadow Icons/Shadow Demos"
    state: directory
  changed_when: false
  when: demo_path.stat.exists and demo_path.stat.isdir

- name: Copy Shadow Demos folder
  copy:
    src: "{{ shadow_demos_folder }}"
    dest: "{{ shadow_hand_launcher_folder }}/Shadow Icons/Shadow Demos"
    directory_mode: yes
    mode: 0755
  changed_when: false
  when: demo_path.stat.exists and demo_path.stat.isdir

- name: Remove Shadow Demos Folder
  file:
    path: "{{ shadow_demos_folder }}"
    state: absent
  become: yes
  changed_when: false

- name: Check if Advanced Launchers folder exist
  stat:
    path: "{{ shadow_advanched_launchers_folder }}"
  register: demo_path

- name: Create Advanced Launchers Folder
  file:
    path: "{{ shadow_hand_launcher_folder }}/Shadow Icons/Shadow Advanced Launchers"
    state: directory
  changed_when: false
  when: demo_path.stat.exists and demo_path.stat.isdir

- name: Copy Shadow Advanced Launchers folder
  copy:
    src: "{{ shadow_advanched_launchers_folder }}"
    dest: "{{ shadow_hand_launcher_folder }}/Shadow Icons/Shadow Advanced Launchers"
    directory_mode: yes
    mode: 0755 
  changed_when: false
  failed_when: false

- name: Ensure Shadow Advanced Launchers folder and contents are deleted
  file:
    path: "{{ shadow_advanched_launchers_folder }}"
    state: absent
  become: yes
  changed_when: false

- name: Check if Simulation folder exist
  stat:
    path: "{{ shadow_simulation_folder }}"
  register: demo_path

- name: Create Simulation Folder
  file:
    path: "{{ shadow_hand_launcher_folder }}/Shadow Icons/Simulation"
    state: directory
  changed_when: false
  when: demo_path.stat.exists and demo_path.stat.isdir

- name: Copy Shadow Simulation folder
  copy:
    src: "{{ shadow_simulation_folder }}"
    dest: "{{ shadow_hand_launcher_folder }}/Shadow Icons/Simulation"
    directory_mode: yes
    mode: 0755 
  changed_when: false
  failed_when: false

- name: Ensure Shadow Simulation folder and contents are deleted
  file:
    path: "{{ shadow_simulation_folder }}"
    state: absent
  become: yes
  changed_when: false

- name: Find all .desktop files with Shadow in the comment
  find:
    paths: "{{ desktop_path }}"
    patterns: '*.desktop'
    contains: "^.*Comment=autogenerated_aurora_{{ container_name }}"
  register: file_list

- name: Copy all .desktop files with Shadow in the comment
  copy:
    src: "{{ item.path }}"
    dest: "{{ shadow_hand_launcher_folder }}/Shadow Icons"
    mode: 0755 
  changed_when: false
  with_items: "{{ file_list.files }}"
  failed_when: false

- name: Delete all .desktop files with Shadow in the comment
  file:
    path: "{{ item.path }}"
    state: absent
  become: yes
  changed_when: false
  with_items: "{{ file_list.files }}"

- name: Create shadow_hand_launcher folder
  file:
    path: "{{ shadow_hand_launcher_folder }}/shadow_hand_launcher"
    state: directory
    mode: '0755'
  changed_when: false

- name: Create Single Icon for Dolphin file manager
  copy:
    src: ../../../common/resources/files/shadowlogo.png
    dest: "{{ shadow_hand_launcher_folder }}/shadow_hand_launcher/shadowlogo.png"
    mode: '664'

- name: Create desktop icon for Dolphin file manager
  template:
    src: ../../../common/resources/templates/desktop-icons/standard-icon-command.j2
    dest: "{{ desktop_path }}/Shadow Launcher {{ container_name | replace('_', ' ') | title }}.desktop"
    mode: '755'
  vars:
    desktop_shortcut_name: "Shadow Launcher {{ container_name | replace('_', ' ') | title }}"
    comment: "Shadow Launcher {{ container_name | replace('_', ' ') | title }}"
    exec_command: "dolphin '{{ shadow_hand_launcher_folder }}/Shadow Icons'"
    icon_file_name: "shadowlogo.png"
    folder: "{{ shadow_hand_launcher_folder }}/shadow_hand_launcher"
    start_terminal: "false"
