---
- name: Dolphin file manager installation for Icons handling
  apt:
    name: "dolphin"
    state: 'present'
    update_cache: yes    
  become: yes

- name: Create Dolphin Folder
  file:
    path: "{{ shadow_hand_launcher_folder }}/Shadow Icons"
    state: directory
  become: yes
  changed_when: false

- name: Copy Shadow Demos folder
  copy:
    src: "{{ shadow_demos_folder }}"
    dest: "{{ shadow_hand_launcher_folder }}/Shadow Icons"
    directory_mode: yes
  become: yes    
  changed_when: false

- name: Remove Shadow Demos Folder
  file:
    path: "{{ shadow_demos_folder }}"
    state: absent
  become: yes
  changed_when: false

- name: Copy Shadow Advanced Launchers folder
  copy:
    src: "{{ shadow_advanched_launchers_folder }}"
    dest: "{{ shadow_hand_launcher_folder }}/Shadow Icons"
    directory_mode: yes
  become: yes  
  changed_when: false

- name: Ensure Shadow Advanced Launchers folder and contents are deleted
  file:
    path: "{{ shadow_advanched_launchers_folder }}"
    state: absent
  become: yes
  changed_when: false

- name: Find all .desktop files with Shadow in the comment
  find:
    paths: "{{ desktop_path }}"
    patterns: '*.desktop'
    contains: "^.*Comment=autogenerated_aurora"
  register: file_list

- name: Copy all .desktop files with Shadow in the comment
  copy:
    src: "{{ item.path }}"
    dest: "{{ shadow_hand_launcher_folder }}/Shadow Icons"
  changed_when: false
  become: yes  
  with_items: "{{ file_list.files }}"

- name: Delete all .desktop files with Shadow in the comment
  file:
    path: "{{ item.path }}"
    state: absent
  become: yes
  changed_when: false
  with_items: "{{ file_list.files }}"

- name: Create Single Icon for Dolphin file manager
  copy:
    src: ../../../common/resources/files/demo_icon.png
    dest: "{{ shadow_hand_launcher_folder }}/demo_icon.png"
    mode: '664'

- name: Create desktop icon for Dolphin file manager
  template:
    src: ../../../common/resources/templates/desktop-icons/standard-icon-command.j2
    dest: "{{ user_folder }}/Desktop/Shadow Launcher.desktop"
    mode: '755'
  vars:
    desktop_shortcut_name: "Shadow Launcher"
    comment: "Shadow Launcher"
    exec_command: "dolphin {{ shadow_hand_launcher_folder }}/Shadow Icons"
    icon_file_name: "{{ shadow_hand_launcher_folder }}/demo_icon.png"
    start_terminal: "true"
