---
- name: Ensure botocore and boto3 modules are installed
  pip:
    name: [ "boto3", "botocore"]
    extra_args: "--user"

- name: Connect to Shadow AWS API
  uri:
    url: https://5vv2z6j3a7.execute-api.eu-west-2.amazonaws.com/prod
    method: GET
    return_content: yes
    headers:
      x-api-key: "{{ customer_key }}"
  register: response

- name: Set temporary AWS credentials for accessing necessary files
  set_fact:
    aws_key: "{{ response }}"
    aws_secret: "{{ response }}"

- name: debug
  debug:
    msg: "{{ response }}"

- name: Downloading the hand manual from AWS to Desktop
  aws_s3:
    aws_access_key: "{{ aws_key }}"
    aws_secret_key: "{{ aws_secret }}"
    bucket: shadowrobot.aurora.files
    object: "/server/{{ manual_filename }}"
    dest: "{{ manual_folder }}/{{ manual_filename }}"
    mode: get
