---
- name: Include installation/docker role
  include_role:
    name: installation/docker

- name: Include installation/nvidia-docker, role
  include_role:
    name: installation/nvidia-docker
  when: nvidia_docker|bool

- name: Include installation/openvpn-server role
  include_role:
    name: installation/openvpn-server
  when: use_openvpn|bool

- name: Include docker/docker-image role
  include_role:
    name: docker/docker-image

- name: Include docker/aws role
  include_role:
    name: docker/aws
  when: use_aws|bool

- name: Include products/common/docker-container role
  include_role:
    name: products/common/docker-container

- name: Include products/common/save-logs-icons role
  include_role:
    name: products/common/save-logs-icons

- name: Include products/common/cyberglove role
  include_role:
    name: products/common/cyberglove
  when: use_cyberglove|bool

- name: Include products/teleop/server/desktop-icons role
  include_role:
    name: products/teleop/server/desktop-icons

- name: Make sure there is a 2048-bit SSH private and public keys generated on teleop server (SSH client)
  user:
    name: "{{ user }}"
    generate_ssh_key: yes
    ssh_key_bits: 2048
    ssh_key_file: .ssh/id_rsa

- name: Evaluating the SSH agent and adding the ssh identity
  shell: |
    eval "$(ssh-agent)"
    ssh-add {{ user_folder }}/.ssh/id_rsa
  changed_when: false

- name: Setup script name
  set_fact:
    setup_script: teleop-server-setup.sh

- name: Creating teleop-server setup script
  template:
    src: ../../../common/resources/templates/scripts/setup-hand.j2
    dest: "{{ shadow_hand_launcher_folder }}/{{ setup_script }}"
    mode: '755'

- name: Copying teleop-server setup script into docker container
  changed_when: false
  shell: "docker cp {{ shadow_hand_launcher_folder }}/teleop-server-setup.sh {{ container_name }}:{{ setup_directory }}/{{ setup_script }}"
  become: yes

- name: Udev rules for vive
  get_url:
    url: https://raw.githubusercontent.com/shadow-robot/sr-build-tools/master/docker/utils/steam_udev/60-HTC-Vive-perms-Ubuntu.rules
    dest: /lib/udev/rules.d/60-HTC-Vive-perms-Ubuntu.rules
    mode: '0644'
  become: yes

- name: Udev rules for steam
  get_url:
    url: https://raw.githubusercontent.com/shadow-robot/sr-build-tools/master/docker/utils/steam_udev/99-steam-perms.rules
    dest: /lib/udev/rules.d/99-steam-perms.rules
    mode: '0644'
  become: yes
