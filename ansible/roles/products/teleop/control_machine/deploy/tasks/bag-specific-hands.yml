---
- name: Custom shared volume for bag storage
  block:
  - name: Set shadow_bag_storage folder names
    set_fact:
      shadow_bag_storage_folder: "{{ user_folder }}/shadow_bag_storage"
      shadow_bag_storage_inside_docker: "/home/user/shadow_bag_storage"
      shadow_remote_bag_storage_folder: "/mnt/usb-TOSHIBA_External/storage/test_bags"
      shadow_remote_bag_user: "shadowop"
      shadow_remote_bag_IP: "10.6.10.7"

  - name: Ensure {{ shadow_bag_storage_folder }} folder exists
    file:
      path: "{{ shadow_bag_storage_folder }}"
      mode: '755'
      state: directory

  - name: Set custom shared volumes for docker container
    set_fact:
      custom_shared_volumes: 
        - "{{ shadow_bag_storage_folder }}:{{ shadow_bag_storage_inside_docker }}"

# Creates a cron file under /etc/cron.d
- cron:
    name: sync hand data to NAS
    minute: 45
    user: root
    job: "rsync {{ shadow_bag_storage_folder }}/* {{ shadow_remote_bag_user }}@{{ shadow_remote_bag_IP }}:{{ shadow_remote_bag_storage_folder }}"
    cron_file: sr_sync_hand_data_to_nas
