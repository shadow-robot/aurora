---
- name: Setup script name
  set_fact:
    setup_script: server-setup.sh
    right_setup_script: right-server-setup.sh
    left_setup_script: left-server-setup.sh
    bimanual_setup_script : bimanual-server-setup.sh
    upgrade_script: "upgrade_image.sh"

- name: Set icon picture filenames for hand_lite
  set_fact:
    right_hand_picture: hand_lite.jpg
    left_hand_picture: hand_lite_left.jpg
    bimanual_hands_picture: hand_lite_bimanual.jpg
  when: product=='hand_lite'

- name: Set icon picture filenames for hand_extra_lite
  set_fact:
    right_hand_picture: hand_extra_lite.jpg
    left_hand_picture: hand_extra_lite_left.jpg
    bimanual_hands_picture: hand_extra_lite_bimanual.jpg
  when: product=='hand_extra_lite'

- name: Include installation/terminator role
  include_role:
    name: installation/terminator

- name: Include docker/docker-image role
  include_role:
    name: docker/docker-image

- name: Include products/common/docker-container role
  include_role:
    name: products/common/docker-container
  vars:
    container_terminal_title: "{{ product }} container"

- name: Include installation/lxml role
  include_role:
    name: installation/lxml

- name: Include products/common/save-logs-icons role
  include_role:
    name: products/common/save-logs-icons

- name: Create Shadow Demos folder
  file:
    path: "{{ user_folder }}/Desktop/Shadow Demos"
    mode: '755'
    state: directory

- name: Include products/common/demo-icons role
  include_role:
    name: products/common/demo-icons
  vars:
    demo_icon_folder: "{{ user_folder }}/Desktop/Shadow Demos"
  when: demo_icons|bool

- name: Include products/common/cyberglove role
  include_role:
    name: products/common/cyberglove
  when: use_cyberglove|bool

- name: Include docker/aws role
  include_role:
    name: docker/aws
  when: use_aws|bool

- name: Creating upgrade script
  template:
    src: ../../../common/resources/templates/scripts/upgrade_image.j2
    dest: "{{ shadow_hand_launcher_folder }}/{{ upgrade_script }}"
    mode: '755'
  when: upgrade_check|bool

- name: Include products/common/hand-serial-and-xacro role
  include_role:
    name: products/common/hand-serial
  when: config_branch is defined and config_branch | length > 0

- name: Creating the default setup script
  template:
    src: ../../../common/resources/templates/scripts/setup-hand.j2
    dest: "{{ shadow_hand_launcher_folder }}/{{ setup_script }}"
    mode: '755'
  vars:
    launch_file_name: "sr_rhand.launch"

- name: Copying the default setup script into docker container
  changed_when: false
  shell: "docker cp {{ shadow_hand_launcher_folder }}/{{ setup_script }} {{ container_name }}:{{ setup_directory }}/{{ setup_script }}"
  become: yes

- name: Creating hand-e setup script for right hand
  template:
    src: ../../../common/resources/templates/scripts/setup-hand.j2
    dest: "{{ shadow_hand_launcher_folder }}/{{ right_setup_script }}"
    mode: '755'
  vars:
    launch_file_name: "sr_rhand.launch"
  when: bimanual|bool or hand_side=="right"

- name: Creating the setup script for left hand
  template:
    src: ../../../common/resources/templates/scripts/setup-hand.j2
    dest: "{{ shadow_hand_launcher_folder }}/{{ left_setup_script }}"
    mode: '755'
  vars:
    launch_file_name: "sr_lhand.launch"
  when: bimanual|bool or hand_side=="left"

- name: Creating the setup script for bimanual hands
  template:
    src: ../../../common/resources/templates/scripts/setup-hand.j2
    dest: "{{ shadow_hand_launcher_folder }}/{{ bimanual_setup_script }}"
    mode: '755'
  vars:
    launch_file_name: "sr_bimanual.launch"
  when: bimanual|bool

- name: Copying the hand setup script for right hand launch into docker container
  changed_when: false
  shell: "docker cp {{ shadow_hand_launcher_folder }}/{{ right_setup_script }} {{ container_name }}:{{ setup_directory }}/{{ right_setup_script }}"
  become: yes
  when: bimanual|bool or hand_side=="right"

- name: Copying the hand setup script for left hand launch into docker container
  changed_when: false
  shell: "docker cp {{ shadow_hand_launcher_folder }}/{{ left_setup_script }} {{ container_name }}:{{ setup_directory }}/{{ left_setup_script }}"
  become: yes
  when: bimanual|bool or hand_side=="left"

- name: Copying the hand setup script for bimanual hand launch into docker container
  changed_when: false
  shell: "docker cp {{ shadow_hand_launcher_folder }}/{{ bimanual_setup_script }} {{ container_name }}:{{ setup_directory }}/{{ bimanual_setup_script }}"
  become: yes
  when: bimanual|bool

- name: Install Shadow Right Hand launch if bimanual is true or if hand_side="right"
  block:
  - name: Copy Launch Shadow Right Hand desktop icon
    copy:
      src: "files/{{ right_hand_picture }}"
      dest: "{{ shadow_hand_launcher_folder }}/{{ right_hand_picture }}"
      mode: '664'

  - name: Create Launch Shadow Right Hand script
    template:
      src: ../../../common/resources/templates/scripts/start-docker-container-local.j2
      dest: "{{ shadow_hand_launcher_folder }}/shadow_right_launcher_exec.sh"
      mode: '755'
    vars:
      local_setup_script_var: "{{ right_setup_script }}"

  - name: Create Shadow Right Hand Launch desktop icon
    template:
      src: ../../../common/resources/templates/desktop-icons/standard-icon.j2
      dest: "{{ user_folder }}/Desktop/Launch Shadow Right Hand.desktop"
      mode: '755'
    vars:
      desktop_shortcut_name: "Launch Shadow Right Hand"
      comment: "This is application launches the right hand"
      folder: "{{ shadow_hand_launcher_folder }}"
      shell_script_file_name: shadow_right_launcher_exec.sh
      icon_file_name: "{{ right_hand_picture }}"
      start_terminal: "false"

  - name: Make Shadow Right Hand Launch desktop icon Trusted
    shell: gio set "{{ user_folder }}/Desktop/Launch Shadow Right Hand.desktop" "metadata::trusted" yes
    when:
      - ansible_distribution|string == 'Ubuntu'
      - ansible_distribution_release|string == 'bionic'

  when: bimanual|bool or hand_side=="right"

- name: Install Shadow Left Hand launch if bimanual is true or if hand_side="left"
  block:
  - name: Copy Launch Shadow Left Hand desktop icon
    copy:
      src: "files/{{ left_hand_picture }}"
      dest: "{{ shadow_hand_launcher_folder }}/{{ left_hand_picture }}"
      mode: '664'

  - name: Create Launch Shadow Left Hand script
    template:
      src: ../../../common/resources/templates/scripts/start-docker-container-local.j2
      dest: "{{ shadow_hand_launcher_folder }}/shadow_left_launcher_exec.sh"
      mode: '755'
    vars:
      local_setup_script_var: "{{ left_setup_script }}"

  - name: Create Shadow Left Hand Launch desktop icon
    template:
      src: ../../../common/resources/templates/desktop-icons/standard-icon.j2
      dest: "{{ user_folder }}/Desktop/Launch Shadow Left Hand.desktop"
      mode: '755'
    vars:
      desktop_shortcut_name: "Launch Shadow Left Hand"
      comment: "This is application launches the left hand"
      folder: "{{ shadow_hand_launcher_folder }}"
      shell_script_file_name: shadow_left_launcher_exec.sh
      icon_file_name: "{{ left_hand_picture }}"
      start_terminal: "false"

  - name: Make Shadow Left Hand Launch desktop icon Trusted
    shell: gio set "{{ user_folder }}/Desktop/Launch Shadow Left Hand.desktop" "metadata::trusted" yes
    when:
      - ansible_distribution|string == 'Ubuntu'
      - ansible_distribution_release|string == 'bionic'

  when: bimanual|bool or hand_side=="left"

- name: Install Shadow Bimanual Hands launch if bimanual is true"
  block:
  - name: Copy Launch Shadow Bimanual Hands desktop icon
    copy:
      src: "files/{{ bimanual_hands_picture }}"
      dest: "{{ shadow_hand_launcher_folder }}/{{ bimanual_hands_picture }}"
      mode: '664'

  - name: Create Launch Shadow Bimanual Hands script
    template:
      src: ../../../common/resources/templates/scripts/start-docker-container-local.j2
      dest: "{{ shadow_hand_launcher_folder }}/shadow_bimanual_launcher_exec.sh"
      mode: '755'
    vars:
      local_setup_script_var: "{{ bimanual_setup_script }}"

  - name: Create Shadow Bimanual Hands Launch desktop icon
    template:
      src: ../../../common/resources/templates/desktop-icons/standard-icon.j2
      dest: "{{ user_folder }}/Desktop/Launch Shadow Bimanual Hands.desktop"
      mode: '755'
    vars:
      desktop_shortcut_name: "Launch Shadow Bimanual Hands"
      comment: "This is application launches the bimanual hands"
      folder: "{{ shadow_hand_launcher_folder }}"
      shell_script_file_name: shadow_bimanual_launcher_exec.sh
      icon_file_name: "{{ bimanual_hands_picture }}"
      start_terminal: "false"

  - name: Make Shadow Bimanual Hands Launch desktop icon Trusted
    shell: gio set "{{ user_folder }}/Desktop/Launch Shadow Bimanual Hands.desktop" "metadata::trusted" yes
    when:
      - ansible_distribution|string == 'Ubuntu'
      - ansible_distribution_release|string == 'bionic'

  when: bimanual|bool
