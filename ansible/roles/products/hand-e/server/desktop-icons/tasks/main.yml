---
- name: Ensures that Desktop folder exists
  file:
    path: "{{ user_folder }}/Desktop"
    mode: '755'
    state: directory

- name: Ensures that shadow_hand_launcher directory exists
  file:
    path: "{{ shadow_hand_launcher_folder }}"
    state: directory

- name: Set icon picture filenames for hand_lite
  set_fact:
    right_hand_picture: hand_lite.jpg
    left_hand_picture: hand_lite_left.jpg
    bimanual_hands_picture: hand_lite_bimanual.jpg
  when: product=='hand_lite'

- name: Set icon picture filenames for hand_extra_lite
  set_fact:
    right_hand_picture: hand_extra_lite.jpg
    left_hand_picture: hand_extra_lite_left.jpg
    bimanual_hands_picture: hand_extra_lite_bimanual.jpg
  when: product=='hand_extra_lite'

- name: Install desktop icon for launching everything for Shadow Right Hand
  import_tasks: default-icon-no-terminator.yml
  vars:
    desktop_icon_png: "{{ right_hand_picture }}"
    launch_script: "shadow_launch_everything_right.sh"
    desktop_icon_name: "Launch Shadow Right Hand"
    template: templates/scripts/launch-everything-right.j2
    desktop_icon_path: "Launch Shadow Right Hand"
    launch_terminal: "false"
  when: bimanual|bool or hand_side=="right"

- name: Install desktop icon for launching everything for Shadow Left Hand
  import_tasks: default-icon-no-terminator.yml
  vars:
    desktop_icon_png: "{{ left_hand_picture }}"
    launch_script: "shadow_launch_everything_left.sh"
    desktop_icon_name: "Launch Shadow Left Hand"
    template: templates/scripts/launch-everything-left.j2
    desktop_icon_path: "Launch Shadow Left Hand"
    launch_terminal: "false"
  when: bimanual|bool or hand_side=="left"

- name: Install desktop icon for launching everything for Shadow Bimanual Hands
  import_tasks: default-icon-no-terminator.yml
  vars:
    desktop_icon_png: "{{ bimanual_hands_picture }}"
    launch_script: "shadow_launch_everything_bimanual.sh"
    desktop_icon_name: "Launch Shadow Bimanual Hands"
    template: templates/scripts/launch-everything-bimanual.j2
    desktop_icon_path: "Launch Shadow Bimanual Hands"
    launch_terminal: "false"
  when: bimanual|bool

- name: Include hand-manual role
  include_role:
    name: products/common/hand-manual
  when: customer_key is defined and customer_key | length > 0

- name: Install desktop icon for RQT on NUC
  include_tasks: default-icon-no-terminator.yml
  vars:
    template: templates/scripts/start-docker-container-nuc-command.j2
    desktop_icon_png: "ROS_logo.png"
    launch_script: "nuc_rqt.sh"
    desktop_icon_name: "Shadow NUC RQT"
    desktop_icon_path: "Shadow NUC RQT"
    command_to_run: "rqt"
    launch_terminal: "false"

- name: Create Shadow Demos folder
  file:
    path: "{{ user_folder }}/Desktop/Shadow Demos"
    mode: '755'
    state: directory

- name: Create Shadow Advanced Launchers folder
  file:
    path: "{{ user_folder }}/Desktop/Shadow Advanced Launchers"
    mode: '755'
    state: directory

- name: Install desktop icon for server container
  include_tasks: default-icon.yml
  vars:
    template: ../../../common/resources/templates/scripts/start-docker-container.j2
    desktop_icon_png: "laptop.jpg"
    launch_script: "shadow_server_container.sh"
    desktop_icon_name: "1 - Launch Server Container"
    desktop_icon_path: "Shadow Advanced Launchers/1 - Launch Server Container"
    launch_terminal: "false"

- name: Install desktop icon for launching ROSCORE
  import_tasks: default-icon.yml
  vars:
    template: ../../../common/resources/templates/scripts/start-roscore.j2
    desktop_icon_png: "ROS_logo.png"
    launch_script: "shadow_roscore.sh"
    desktop_icon_name: "2 - Launch Server ROSCORE"
    desktop_icon_path: "Shadow Advanced Launchers/2 - Launch Server ROSCORE"
    launch_terminal: "false"

- name: Install desktop icon for NUC right hand hardware control loop
  import_tasks: hand-icon.yml
  vars:
    desktop_icon_png: "{{ right_hand_picture }}"
    launch_script: "shadow_nuc_right_hardware_control_loop.sh"
    hand_branch: "{{ config_branch }}"
    desktop_icon_name: "3 - Launch NUC Container and Right Hand Hardware Control Loop"
    desktop_icon_path: "Shadow Advanced Launchers/3 - Launch NUC Container and Right Hand Hardware Control Loop"
    ethercat_interface_value: "{{ ethercat_interface }}"
    hand_serial_value: "{{ hand_serial }}"
    hand_side_value: "right"
    xacro_value: "{{ xacro_right }}"
    mapping_path_value: "{{ mapping_path_right }}"
    pwm_control_value: "true"
  when: bimanual|bool or hand_side=="right"

- name: Install desktop icon for NUC left hand hardware control loop
  import_tasks: hand-icon.yml
  vars:
    desktop_icon_png: "{{ left_hand_picture }}"
    launch_script: "shadow_nuc_left_hardware_control_loop.sh"
    hand_branch: "{{ config_branch }}"
    desktop_icon_name: "3 - Launch NUC Container and Left Hand Hardware Control Loop"
    desktop_icon_path: "Shadow Advanced Launchers/3 - Launch NUC Container and Left Hand Hardware Control Loop"
    ethercat_interface_value: "{{ ethercat_left_hand }}"
    hand_serial_value: "{{ hand_serial_left }}"
    hand_side_value: "left"
    xacro_value: "{{ xacro_left }}"
    mapping_path_value: "{{ mapping_path_left }}"
    pwm_control_value: "true"
  when: bimanual|bool or hand_side=="left"

- name: Install desktop icon for NUC bimanual hands hardware control loop
  import_tasks: hand-icon-bimanual.yml
  vars:
    desktop_icon_png: "{{ bimanual_hands_picture }}"
    launch_script: "shadow_nuc_bimanual_hardware_control_loop.sh"
    hand_branch: "{{ config_branch }}"
    desktop_icon_name: "3 - Launch NUC Container and Bimanual Hands Hardware Control Loop"
    desktop_icon_path: "Shadow Advanced Launchers/3 - Launch NUC Container and Bimanual Hands Hardware Control Loop"
  when: bimanual|bool

- name: Install desktop icon for Teach mode - Right Hand
  import_tasks: hand-icon.yml
  vars:
    desktop_icon_png: "{{ right_hand_picture }}"
    launch_script: "shadow_teach_mode_right.sh"
    hand_branch: "{{ config_branch }}"
    desktop_icon_name: "3 - Teach mode - Right Hand"
    desktop_icon_path: "Shadow Advanced Launchers/3 - Teach mode - Right Hand"
    ethercat_interface_value: "{{ ethercat_interface }}"
    hand_serial_value: "{{ hand_serial }}"
    hand_side_value: "right"
    xacro_value: "{{ xacro_right }}"
    mapping_path_value: "{{ mapping_path_right }}"
    pwm_control_value: "false"
  when: bimanual|bool or hand_side=="right"

- name: Install desktop icon for Teach mode - Left Hand
  import_tasks: hand-icon.yml
  vars:
    desktop_icon_png: "{{ left_hand_picture }}"
    launch_script: "shadow_teach_mode_left.sh"
    hand_branch: "{{ config_branch }}"
    desktop_icon_name: "3 - Teach mode - Left Hand"
    desktop_icon_path: "Shadow Advanced Launchers/3 - Teach mode - Left Hand"
    ethercat_interface_value: "{{ ethercat_left_hand }}"
    hand_serial_value: "{{ hand_serial_left }}"
    hand_side_value: "left"
    xacro_value: "{{ xacro_left }}"
    mapping_path_value: "{{ mapping_path_left }}"
    pwm_control_value: "false"
  when: bimanual|bool or hand_side=="left"

- name: Install Local Teach mode - Right Hand desktop icon if bimanual is true or if hand_side="right"
  import_tasks: roslaunch-icon.yml
  vars:
    desktop_icon_png: "{{ right_hand_picture }}"
    launch_script: "shadow_local_teach_mode_right.sh"
    project_name_input: "sr_robot_launch"
    launch_file_input: "sr_hardware_control_loop.launch hand_serial:={{ hand_serial }} eth_port:={{ ethercat_interface }} side:=right pwm_control:=false arm_ctrl:=false"
    desktop_icon_name: "3 - Local Teach mode - Right Hand"
    desktop_icon_path: "Shadow Advanced Launchers/3 - Local Teach mode - Right Hand"
  when: bimanual|bool or hand_side=="right"

- name: Install Local Teach mode - Left Hand desktop icon if bimanual is true or if hand_side="left"
  import_tasks: roslaunch-icon.yml
  vars:
    desktop_icon_png: "{{ left_hand_picture }}"
    launch_script: "shadow_local_teach_mode_left.sh"
    project_name_input: "sr_robot_launch"
    launch_file_input: "sr_hardware_control_loop.launch hand_serial:={{ hand_serial_left }} eth_port:={{ ethercat_left_hand }} side:=left pwm_control:=false arm_ctrl:=false"
    desktop_icon_name: "3 - Local Teach mode - Left Hand"
    desktop_icon_path: "Shadow Advanced Launchers/3 - Local Teach mode - Left Hand"
  when: bimanual|bool or hand_side=="left"

- name: Install desktop icon for right hand GUI
  import_tasks: roslaunch-icon.yml
  vars:
    desktop_icon_png: "rviz.png"
    launch_script: "shadow_GUI_right.sh"
    project_name_input: "sr_robot_launch"
    launch_file_input: "srhand.launch external_control_loop:=true sim:=false hand_id:=rh"
    desktop_icon_name: "4 - Launch Server Right Hand GUI"
    desktop_icon_path: "Shadow Advanced Launchers/4 - Launch Server Right Hand GUI"
  when: bimanual|bool or hand_side=="right"

- name: Install desktop icon for left hand GUI
  import_tasks: roslaunch-icon.yml
  vars:
    desktop_icon_png: "rviz.png"
    launch_script: "shadow_GUI_left.sh"
    project_name_input: "sr_robot_launch"
    launch_file_input: "srhand.launch external_control_loop:=true sim:=false hand_id:=lh"
    desktop_icon_name: "4 - Launch Server Left Hand GUI"
    desktop_icon_path: "Shadow Advanced Launchers/4 - Launch Server Left Hand GUI"
  when: bimanual|bool or hand_side=="left"

- name: Install desktop icon for bimanual hand GUI
  import_tasks: roslaunch-icon.yml
  vars:
    desktop_icon_png: "rviz.png"
    launch_script: "shadow_GUI_bimanual.sh"
    project_name_input: "sr_robot_launch"
    launch_file_input: "sr_bimanual.launch external_control_loop:=true sim:=false robot_config_file:='{{ robot_config_bimanual }}'"
    desktop_icon_name: "4 - Launch Server Bimanual GUI"
    desktop_icon_path: "Shadow Advanced Launchers/4 - Launch Server Bimanual GUI"
  when: bimanual|bool

- name: Install desktop icon for NUC container
  include_tasks: default-icon.yml
  vars:
    template: templates/scripts/start-docker-container-nuc-interactive-terminal.j2
    desktop_icon_png: "nuc.png"
    launch_script: "shadow_nuc_container.sh"
    desktop_icon_name: "Launch NUC Container"
    desktop_icon_path: "Shadow Advanced Launchers/Launch NUC Container"
    launch_terminal: "false"

- name: Include products/common/demo-icons role
  include_role:
    name: products/common/demo-icons
  vars:
    demo_icon_folder: "{{ user_folder }}/Desktop/Shadow Demos"
  when: demo_icons|bool

- name: Install local Shadow Right Hand launch if bimanual is true or if hand_side="right"
  block:
  - name: Copy Launch Local Shadow Right Hand desktop icon
    copy:
      src: "files/{{ right_hand_picture }}"
      dest: "{{ shadow_hand_launcher_folder }}/{{ right_hand_picture }}"
      mode: '664'

  - name: Create Launch Local Shadow Right Hand script
    template:
      src: ../../../common/resources/templates/scripts/start-docker-container-local.j2
      dest: "{{ shadow_hand_launcher_folder }}/shadow_local_right_launcher_exec.sh"
      mode: '755'
    vars:
      local_setup_script_var: "{{ local_right_setup_script }}"

  - name: Create Shadow Local Right Hand Launch desktop icon
    template:
      src: ../../../common/resources/templates/desktop-icons/standard-icon.j2
      dest: "{{ user_folder }}/Desktop/Shadow Advanced Launchers/Launch Local Shadow Right Hand.desktop"
      mode: '755'
    vars:
      desktop_shortcut_name: "Launch Local Shadow Right Hand"
      comment: "This is application launches the right hand locally without the NUC"
      folder: "{{ shadow_hand_launcher_folder }}"
      shell_script_file_name: shadow_local_right_launcher_exec.sh
      icon_file_name: "{{ right_hand_picture }}"
      start_terminal: "false"

  - name: Make Shadow Local Right Hand Launch desktop icon Trusted
    shell: gio set "{{ user_folder }}/Desktop/Shadow Advanced Launchers/Launch Local Shadow Right Hand.desktop" "metadata::trusted" yes
    when:
      - ansible_distribution|string == 'Ubuntu'
      - ansible_distribution_release|string == 'bionic'
      - skip_molecule_task is not defined
  when: bimanual|bool or hand_side=="right"

- name: Install local Shadow Left Hand launch if bimanual is true or if hand_side="left"
  block:
  - name: Copy Launch Local Shadow Left Hand desktop icon
    copy:
      src: "files/{{ left_hand_picture }}"
      dest: "{{ shadow_hand_launcher_folder }}/{{ left_hand_picture }}"
      mode: '664'

  - name: Create Launch Local Shadow Left Hand script
    template:
      src: ../../../common/resources/templates/scripts/start-docker-container-local.j2
      dest: "{{ shadow_hand_launcher_folder }}/shadow_local_left_launcher_exec.sh"
      mode: '755'
    vars:
      local_setup_script_var: "{{ local_left_setup_script }}"

  - name: Create Shadow Local Left Hand Launch desktop icon
    template:
      src: ../../../common/resources/templates/desktop-icons/standard-icon.j2
      dest: "{{ user_folder }}/Desktop/Shadow Advanced Launchers/Launch Local Shadow Left Hand.desktop"
      mode: '755'
    vars:
      desktop_shortcut_name: "Launch Local Shadow Left Hand"
      comment: "This is application launches the left hand locally without the NUC"
      folder: "{{ shadow_hand_launcher_folder }}"
      shell_script_file_name: shadow_local_left_launcher_exec.sh
      icon_file_name: "{{ left_hand_picture }}"
      start_terminal: "false"

  - name: Make Shadow Local Left Hand Launch desktop icon Trusted
    shell: gio set "{{ user_folder }}/Desktop/Shadow Advanced Launchers/Launch Local Shadow Left Hand.desktop" "metadata::trusted" yes
    when:
      - ansible_distribution|string == 'Ubuntu'
      - ansible_distribution_release|string == 'bionic'
      - skip_molecule_task is not defined
  when: bimanual|bool or hand_side=="left"

- name: Install local Shadow Bimanual Hands launch if bimanual is true
  block:
  - name: Copy Launch Local Shadow Bimanual Hands desktop icon
    copy:
      src: "files/{{ bimanual_hands_picture }}"
      dest: "{{ shadow_hand_launcher_folder }}/{{ bimanual_hands_picture }}"
      mode: '664'

  - name: Create Launch Local Shadow Bimanual Hands script
    template:
      src: ../../../common/resources/templates/scripts/start-docker-container-local.j2
      dest: "{{ shadow_hand_launcher_folder }}/shadow_local_bimanual_launcher_exec.sh"
      mode: '755'
    vars:
      local_setup_script_var: "{{ local_bm_setup_script }}"

  - name: Create Shadow Local Bimanual Hands Launch desktop icon
    template:
      src: ../../../common/resources/templates/desktop-icons/standard-icon.j2
      dest: "{{ user_folder }}/Desktop/Shadow Advanced Launchers/Launch Local Shadow Bimanual Hands.desktop"
      mode: '755'
    vars:
      desktop_shortcut_name: "Launch Local Shadow Bimanual Hands"
      comment: "This is application launches the bimanual hands locally without the NUC"
      folder: "{{ shadow_hand_launcher_folder }}"
      shell_script_file_name: shadow_local_bimanual_launcher_exec.sh
      icon_file_name: "{{ bimanual_hands_picture }}"
      start_terminal: "false"

  - name: Make Shadow Local Bimanual Hands Launch desktop icon Trusted
    shell: gio set "{{ user_folder }}/Desktop/Shadow Advanced Launchers/Launch Local Shadow Bimanual Hands.desktop" "metadata::trusted" yes
    when:
      - ansible_distribution|string == 'Ubuntu'
      - ansible_distribution_release|string == 'bionic'
      - skip_molecule_task is not defined
  when: bimanual|bool
