---
- name: Copy desktop icon
  copy:
    src: files/{{ desktop_icon_png }}
    dest: "{{ shadow_hand_launcher_folder }}/{{ desktop_icon_png }}"
    mode: '664'

- name: Set launch file path based on hand_side {{ hand_side }} for getting hand_serial
  set_fact:
    launch_file_path: "{{ shadow_hand_launcher_folder }}/sr_{{ hand_side[0] }}hand.launch"

- name: Download the launch file config branch {{ config_branch }} and hand_side {{ hand_side }} from Github
  get_url:
    url: "https://raw.githubusercontent.com/shadow-robot/sr-config/{{ config_branch }}/sr_ethercat_hand_config/launch/sr_{{ hand_side[0] }}hand.launch"
    dest: "{{ launch_file_path }}"
    mode: '755'

- name: Get the hand_serial xml_response from the launch file
  xml:
    path: "{{ launch_file_path }}"
    xpath: "//attribute::*[contains(., 's{{ hand_side[0] }}hand.launch')]/..//attribute::*[contains(., 'hand_serial')]/.."
    content: attribute
  register: xml_response

- name: Set the hand_serial from xml_response
  set_fact:
    hand_serial: "{{ xml_response.matches[0].value }}"

- name: Create executable launch script for hand
  template:
    src: templates/scripts/start-docker-container-nuc.j2
    dest: "{{ shadow_hand_launcher_folder }}/{{ launch_script }}"
    mode: '755'
  vars:
    config_branch: "{{ hand_branch }}"

- name: Create desktop icon for hand
  template:
    src: ../../../common/resources/templates/desktop-icons/standard-icon.j2
    dest: "{{ user_folder }}/Desktop/{{ desktop_icon_path }}.desktop"
    mode: '755'
  vars:
    desktop_shortcut_name: "{{ desktop_icon_name }}"
    comment: "{{ desktop_icon_name }}"
    folder: "{{ shadow_hand_launcher_folder }}"
    shell_script_file_name: "{{ launch_script }}"
    icon_file_name: "{{ desktop_icon_png }}"
    start_terminal: "true"

- name: Make desktop icon for hand trusted
  shell: gio set "{{ user_folder }}/Desktop/{{ desktop_icon_path }}.desktop" "metadata::trusted" yes
  when:
    - ansible_distribution|string == 'Ubuntu'
    - ansible_distribution_release|string == 'bionic'
